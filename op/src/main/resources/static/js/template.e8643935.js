(function(t){function e(e){for(var n,o,a=e[0],l=e[1],c=e[2],d=0,f=[];d<a.length;d++)o=a[d],Object.prototype.hasOwnProperty.call(s,o)&&s[o]&&f.push(s[o][0]),s[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(t[n]=l[n]);u&&u(e);while(f.length)f.shift()();return r.push.apply(r,c||[]),i()}function i(){for(var t,e=0;e<r.length;e++){for(var i=r[e],n=!0,a=1;a<i.length;a++){var l=i[a];0!==s[l]&&(n=!1)}n&&(r.splice(e--,1),t=o(o.s=i[0]))}return t}var n={},s={template:0},r=[];function o(e){if(n[e])return n[e].exports;var i=n[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=t,o.c=n,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)o.d(i,n,function(e){return t[e]}.bind(null,n));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="/";var a=window["webpackJsonp"]=window["webpackJsonp"]||[],l=a.push.bind(a);a.push=e,a=a.slice();for(var c=0;c<a.length;c++)e(a[c]);var u=l;r.push([1,"chunk-vendors"]),i()})({1:function(t,e,i){t.exports=i("3c97")},"3c97":function(t,e,i){"use strict";i.r(e);i("e260"),i("e6cf"),i("cca6"),i("a79d");var n,s=i("2b0e"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"app"}},[t.isShow&&t.isLogin?i("AddTemplate"):t._e()],1)},o=[],a=(i("ac1f"),i("841c"),function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"content"},[i("div",{staticClass:"tags"},[i("div",{staticStyle:{display:"flex","align-items":"center","justify-content":"space-between",width:"100%"}},[i("div",{staticStyle:{flex:"1"}},[i("el-button",{staticClass:"button-new-tag",attrs:{type:"primary",size:"small"},on:{click:function(e){return t.open1()}}},[t._v("新建节点")]),i("el-button",{staticClass:"button-new-tag",staticStyle:{"margin-right":"20px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.open2()}}},[t._v("新建连线")]),t._l(t.tags,(function(e,n){return i("el-tag",{key:n,staticStyle:{"margin-left":"10px",cursor:"pointer"},attrs:{type:"info",size:"mini",effect:"dark",color:e.style.fill}},[t._v(t._s(e.type))])}))],2),i("div",[i("el-button",{staticClass:"button-new-tag",attrs:{type:"success",size:"small"},on:{click:function(e){return t.open3()}}},[t._v("保存模板")])],1)])]),i("div",{ref:"svgDiv",class:t.svgFocus?"cfocus":"",attrs:{id:"svg"}}),i("el-dialog",{staticClass:"dialog-index",attrs:{visible:t.visible,title:"节点信息","close-on-click-modal":!1,"destroy-on-close":"",width:"500px"},on:{close:t.close}},[i("el-form",{ref:"tagform",attrs:{"label-width":"100px",model:t.tagform,rules:t.tagRules,size:"mini"}},[i("el-form-item",{attrs:{label:"节点类型",prop:"type"}},[i("el-input",{attrs:{maxlength:"50",placeholder:"请输入节点类型"},on:{blur:t.setColor},model:{value:t.tagform.type,callback:function(e){t.$set(t.tagform,"type",e)},expression:"tagform.type"}})],1),i("el-row",[i("el-col",{attrs:{span:24}},[i("el-form-item",{attrs:{label:"properties",prop:"properties"}},[i("input-prop",{ref:"inputProp",attrs:{showPropList:!1},model:{value:t.tagform.properties,callback:function(e){t.$set(t.tagform,"properties",e)},expression:"tagform.properties"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"填充颜色",prop:"fill"}},[i("el-color-picker",{staticStyle:{width:"100%"},attrs:{predefine:t.predefineColors},model:{value:t.tagform.fill,callback:function(e){t.$set(t.tagform,"fill",e)},expression:"tagform.fill"}})],1)],1),i("el-col",{attrs:{span:12}},[i("el-form-item",{attrs:{label:"描边颜色",prop:"stroke"}},[i("el-color-picker",{staticStyle:{width:"100%"},model:{value:t.tagform.stroke,callback:function(e){t.$set(t.tagform,"stroke",e)},expression:"tagform.stroke"}})],1)],1)],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){return t.close()}}},[t._v("取 消")]),t.tagform.id?i("el-button",{attrs:{size:"small"},on:{click:function(e){return t.delNode()}}},[t._v("删 除")]):t._e(),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.ok()}}},[t._v("保 存")])],1)],1),i("el-dialog",{staticClass:"dialog-index",attrs:{visible:t.visible2,title:"连线信息","close-on-click-modal":!1,"destroy-on-close":"",width:"500px"},on:{close:t.close2}},[i("div",[t._l(t.tempLinks,(function(e,n){return i("el-row",{key:n,attrs:{gutter:8}},[i("el-col",{attrs:{span:7}},[i("el-select",{attrs:{size:"mini",placeholder:"source"},model:{value:e.source,callback:function(i){t.$set(e,"source",i)},expression:"v.source"}},t._l(t.nodes,(function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1),i("el-col",{attrs:{span:6}},[i("el-input",{attrs:{maxlength:"50",size:"mini",placeholder:"关系描述"},model:{value:e.type,callback:function(i){t.$set(e,"type",i)},expression:"v.type"}})],1),i("el-col",{attrs:{span:7}},[i("el-select",{attrs:{size:"mini",placeholder:"target"},model:{value:e.target,callback:function(i){t.$set(e,"target",i)},expression:"v.target"}},t._l(t.nodes,(function(t,e){return i("el-option",{key:e,attrs:{label:t.name,value:t.id}})})),1)],1),i("el-col",{attrs:{span:2}},[i("el-color-picker",{staticStyle:{width:"100%"},attrs:{size:"mini"},model:{value:e.color,callback:function(i){t.$set(e,"color",i)},expression:"v.color"}})],1),i("el-col",{attrs:{span:2}},[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){return t.delLink(n)}}},[t._v("删除")])],1)],1)})),i("div",[i("el-button",{attrs:{type:"text",size:"small"},on:{click:t.addLink}},[t._v("新增连线")])],1)],2),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){return t.close2()}}},[t._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.ok2()}}},[t._v("保 存")])],1)]),i("el-dialog",{staticClass:"dialog-index",attrs:{visible:t.visible3,title:"保存模板","close-on-click-modal":!1,"destroy-on-close":"",width:"400px"},on:{close:t.close3}},[i("el-form",{ref:"modelform",attrs:{"label-width":"70px",model:t.modelForm,rules:t.modelRules,size:"mini"}},[i("el-form-item",{attrs:{label:"节点类型",prop:"modelname"}},[i("el-input",{attrs:{maxlength:"50",placeholder:"请输入节点类型"},on:{blur:t.setColor},model:{value:t.modelForm.modelname,callback:function(e){t.$set(t.modelForm,"modelname",e)},expression:"modelForm.modelname"}})],1),i("el-form-item",{attrs:{label:"模板说明",prop:"remark"}},[i("el-input",{attrs:{type:"textarea",maxlength:"200",placeholder:"请输入模板说明"},on:{blur:t.setColor},model:{value:t.modelForm.remark,callback:function(e){t.$set(t.modelForm,"remark",e)},expression:"modelForm.remark"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{size:"small"},on:{click:function(e){return t.close3()}}},[t._v("取 消")]),i("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.ok3()}}},[t._v("保 存")])],1)],1)],1)}),l=[],c=(i("cb29"),i("4de4"),i("caad"),i("c975"),i("d81d"),i("a434"),i("b0c0"),i("4d63"),i("25f0"),i("466d"),i("d32f")),u=i("bc3a"),d=i.n(u),f=i("4b2a");function p(t,e){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i");e=e||window.location.search;var n=e.substr(1).match(i);return null!=n?unescape(n[2]):null}var h=1,g=0,m={name:"AddTemplate",inject:["reload"],components:{InputProp:f["a"]},data:function(){return{visible:!1,visible2:!1,visible3:!1,nodes:[],links:[],tempLinks:[],predefineColors:["#ffcf3c","#c990c0","#f79767","#57c7e3","#f16667","#d9c8ae","#8dcc93","#ecb5c9","#4c8eda","#ffc454","#da7194","#569480"],tagform:{id:null,properties:{},size:"",fill:"",stroke:"",type:""},tagRules:{type:[{required:!0,message:"请输入节点类型",trigger:"blur"}],fill:[{required:!0,message:"请选择一个填充颜色",trigger:"change"}],stroke:[{required:!0,message:"请选择一个描边颜色",trigger:"change"}]},modelForm:{id:"",modelname:"",remark:""},modelRules:{modelname:[{required:!0,message:"请输入模板名",trigger:"blur"}],remark:[{required:!0,message:"请输入模板说明",trigger:"blur"}]},svgFocus:!1,d:null}},computed:{tags:function(){var t=[],e=[];if(this.nodes)for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i];e.includes(n.type)||(t.push(n),e.push(n.type))}return t}},methods:{getPredefineColors:function(){return this.predefineColors[g++]},open1:function(t){t=t||{},this.tagform={id:t.id||null,name:t.name||"",properties:t.properties||{name:""},size:t.size||"",fill:(t.style||{}).fill||this.getPredefineColors(),stroke:(t.style||{}).stroke||"#FFFFFF",type:t.type||""},g>=this.predefineColors.length&&(g=0),this.visible=!0},close:function(){this.visible=!1},delNode:function(){var t=this,e=this.tagform;this.$confirm("确定删除节点"+e.name+"和相关连线的吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){t.nodes=t.nodes.filter((function(t){return t.id!=e.id})),t.links=t.links.filter((function(t){return t.target!=e.id&&t.source!=e.id})),t.close(),t.updateD3()})).catch((function(){}))},ok:function(){var t=this;this.$refs.tagform.validate((function(e){if(e){var i=t.tagform;if(/^\d+/.test(i.type))return void t.$message.warning("节点类型不能以数字为开头");if(t.$refs.inputProp.emitInput())return;t.$nextTick((function(){var e="",n=i.properties||{};for(var s in n)Object.hasOwnProperty.call(n,s)&&n[s]&&(e=n[s]);if(e){for(var r,o=0;o<t.nodes.length;o++){var a=t.nodes[o];a.id==i.id&&(r=o),a.type==t.tagform.type&&(a.style={fill:i.fill,stroke:i.stroke})}var l={id:i.id||h+++"",name:e,style:{fill:i.fill,stroke:i.stroke},type:i.type,size:"20",properties:i.properties};void 0!=r?t.nodes[r]=l:t.nodes.push(l),t.nodes.push(),t.close(),t.updateD3()}else t.$message.warning("properties至少需要录入一条内容")}))}}))},setColor:function(){if(this.tagform.type)for(var t=0;t<this.nodes.length;t++){var e=this.nodes[t];if(e.type==this.tagform.type){this.tagform.fill=e.style.fill,this.tagform.stroke=e.style.stroke;break}}},open2:function(){this.tempLinks=JSON.parse(JSON.stringify(this.links)),this.visible2=!0},close2:function(){this.visible2=!1},ok2:function(){for(var t=[],e=0;e<this.tempLinks.length;e++){var i=this.tempLinks[e];if(!i.target||!i.source||!i.type)return void this.$message.warning("请补全信息！");if(/^\d+/.test(i.type))return this.$message.warning("关系描述不能以数字为开头"),!0;if(!i.color)return void this.$message.warning("请选择颜色！");if(i.source==i.target)return void this.$message.warning("source和target不能为同一个节点！");if(t.includes(i.source+i.target))return void this.$message.warning("有重复的连线！");t.push(i.source+i.target)}this.links=this.tempLinks,this.close2(),this.updateD3()},updateD3:function(){this.d.update({nodes:JSON.parse(JSON.stringify(this.nodes)),links:JSON.parse(JSON.stringify(this.links))})},addLink:function(){this.tempLinks.push({id:h+++"",source:"",size:"1",color:"#545454",type:"",target:""})},delLink:function(t){this.tempLinks.splice(t,1)},startD3:function(t,e){this.d=c["a"].init("svg",{width:window.document.body.offsetWidth,height:window.document.body.offsetHeight,nodes:t,links:e,svgClick:this.svgClick,textClick:this.open2})},reset:function(){this.$refs.svgDiv.innerHTML=""},open3:function(){if(this.nodes&&this.nodes.length>1){for(var t=this.nodes.map((function(t){return t.id})),e=0;e<this.links.length;e++){var i=this.links[e],n=t.indexOf(i.target);n>-1&&t.splice(n,1);var s=t.indexOf(i.source);s>-1&&t.splice(s,1)}if(t.length>0)return void this.$message.warning("所有节点都需要添加连接，请检查！");this.visible3=!0}else this.$message.warning("至少需要两个节点！")},close3:function(){this.visible3=!1},ok3:function(){var t=this;this.$refs.modelform.validate((function(e){if(e){var i={userc:t.$cookies.get("ygg1412"),modelname:t.modelForm.modelname,remark:t.modelForm.remark,nodes:t.nodes,edges:t.links};d.a.get("/saveModel?modelString="+encodeURIComponent(JSON.stringify(i))).then((function(){this.$message.success("保存成功"),this.close3()})).catch((function(t){console.log(t)}))}}),(function(){}))},windowResize:function(){var t=this;n&&clearTimeout(n),n=setTimeout((function(){t.reset(),n=void 0,t.startD3(t.nodes,t.links)}),300)},svgClick:function(t){t&&this.open1(t),this.d.highlightObject(),this.svgFocus=!1},setData:function(){this.nodes=[],this.links=[],this.startD3(this.nodes,this.links)},initData:function(t){var e=this;d.a.get("/getModelData?mid="+t).then((function(t){if(200!=t.status||t.data.error)e.$message.error(t.data.error||t.statusText);else{var i=t.data;e.nodes=i.nodes||[],e.links=i.links||[],e.startD3(e.nodes,e.links)}})).catch((function(t){console.log(t)}))}},created:function(){var t=p("mid",location.search);t&&this.initData(t)},mounted:function(){this.setData(),window.addEventListener("resize",this.windowResize)},destroyed:function(){window.removeEventListener("resize",this.windowResize)}},v=m,k=(i("dd8b"),i("2877")),y=Object(k["a"])(v,a,l,!1,null,"0a0e0d30",null),b=y.exports,x=i("8c1b"),w={name:"app",components:{AddTemplate:b},provide:function(){return{reload:this.reload}},methods:{reload:function(){var t=this;this.isShow=!1,this.$nextTick((function(){t.isShow=!0}))},goIndex:function(){"/login.html"!=location.pathname&&(location.href="/login.html")}},data:function(){return{isLogin:!1,isShow:!0,search:""}},created:function(){var t=this,e=this,i=this.$cookies.get("ygg1412");x["a"].isLogin(i,(function(i,n){!1===i?(e.goIndex(),e.$message.error(n)):(t.isLogin=!0,console.log(i))})),this.search=location.search}},$=w,_=(i("c94a"),Object(k["a"])($,r,o,!1,null,null,null)),C=_.exports,S=(i("7378"),i("2b27")),O=i.n(S);s["default"].config.productionTip=!1,s["default"].use(O.a),new s["default"]({render:function(t){return t(C)}}).$mount("#app")},4937:function(t,e,i){},"4b2a":function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[t._l(t.values,(function(e,n){return i("el-row",{key:n},[i("el-col",{attrs:{span:6}},[t.showPropList?i("el-select",{attrs:{placeholder:"key",filterable:""},model:{value:e.key,callback:function(i){t.$set(e,"key",i)},expression:"v.key"}},t._l(t.propList,(function(t,e){return i("el-option",{key:e,attrs:{label:t.label[0],value:t.label[0]}})})),1):i("el-input",{attrs:{placeholder:"key"},model:{value:e.key,callback:function(i){t.$set(e,"key",i)},expression:"v.key"}})],1),i("el-col",{attrs:{span:16}},[i("el-input",{attrs:{placeholder:"请输入value"},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"v.value"}})],1),i("el-col",{staticStyle:{"text-align":"right"},attrs:{span:2}},[i("el-button",{staticStyle:{"margin-left":"5px"},attrs:{disabled:t.values.length<2,type:"text"},on:{click:function(e){return t.del(n)}}},[t._v("删除")])],1)],1)})),i("el-row",{style:{paddingTop:t.values.length>0?"8px":"0"}},[i("el-col",{attrs:{span:20}},[i("el-button",{staticStyle:{"margin-left":"5px"},attrs:{type:"text"},on:{click:t.add}},[t._v("增加")])],1)],1),i("div",{staticStyle:{padding:"8px"}})],2)},s=[],r=(i("a434"),i("d3b7"),i("ddb0"),{name:"input-prop",props:{value:Object,showPropList:{type:Boolean,default:!0},propList:{type:Array,default:function(){return[]}}},data:function(){return{values:[]}},watch:{value:function(t){t&&this.setValues(t)}},mounted:function(){this.setValues(this.value)},methods:{setValues:function(t){var e=[];for(var i in t)if(Object.hasOwnProperty.call(t,i)){var n=t[i];e.push({key:i,value:n})}this.values=e},emitInput:function(){for(var t={},e=0;e<this.values.length;e++){var i=this.values[e];if(!i.key)return this.$message.error("key不能为空"),!0;if(/^\d+/.test(i.key))return this.$message.warning("key不能以数字为开头"),!0;if(!i.value)return this.$message.error("value不能为空"),!0;if(void 0!=t[i.key])return this.$message.error("key不能重复"),!0;t[i.key]=i.value}this.$emit("input",t)},add:function(){this.values.push({key:"",value:""})},del:function(t){this.values.splice(t,1)}}}),o=r,a=i("2877"),l=Object(a["a"])(o,n,s,!1,null,null,null);e["a"]=l.exports},7378:function(t,e,i){"use strict";i("9e1f"),i("450d");var n=i("6ed5"),s=i.n(n),r=(i("0fb7"),i("f529")),o=i.n(r),a=(i("a586"),i("7464")),l=i.n(a),c=(i("2986"),i("14e9")),u=i.n(c),d=(i("eca7"),i("3787")),f=i.n(d),p=(i("425f"),i("4105")),h=i.n(p),g=(i("a7cc"),i("df33")),m=i.n(g),v=(i("cbb5"),i("8bbc")),k=i.n(v),y=(i("6611"),i("e772")),b=i.n(y),x=(i("1f1a"),i("4e4b")),w=i.n(x),$=(i("10cb"),i("f3ad")),_=i.n($),C=(i("1951"),i("eedf")),S=i.n(C),O=(i("f4f9"),i("c2cc")),z=i.n(O),L=(i("7a0f"),i("0f6c")),j=i.n(L),M=i("2b0e");M["default"].use(j.a),M["default"].use(z.a),M["default"].use(S.a),M["default"].use(_.a),M["default"].use(w.a),M["default"].use(b.a),M["default"].use(k.a),M["default"].use(m.a),M["default"].use(h.a),M["default"].use(f.a),M["default"].use(u.a),M["default"].use(l.a),M["default"].prototype.$message=o.a,M["default"].prototype.$msgbox=s.a,M["default"].prototype.$alert=s.a.alert,M["default"].prototype.$confirm=s.a.confirm,M["default"].prototype.$prompt=s.a.prompt},"7fe2":function(t,e,i){},"8c1b":function(t,e,i){"use strict";var n=i("bc3a"),s=i.n(n),r="查询用户信息失败";e["a"]={isLogin:function(t,e){if(t){var i=new FormData;i.append("property",t),s.a.post("/initUserInfo",i).then((function(t){var i=t.data||{};200==t.status?null!=i.sus?e(i,i.sus):e(!1,i.error||r):e(i.error||r)})).catch((function(){e(!1,r)}))}else e(!1,"未登录")}}},c94a:function(t,e,i){"use strict";i("4937")},d32f:function(t,e,i){"use strict";i("99af"),i("cb29"),i("4de4"),i("4160"),i("c975"),i("b0c0"),i("159b");var n=i("5530"),s=i("5698");function r(t){function e(e){e.active||t.alphaTarget(.1).restart(),e.subject.fx=e.subject.x,e.subject.fy=e.subject.y}function i(t){t.subject.fx=t.x,t.subject.fy=t.y}function n(e){e.active||t.alphaTarget(0),e.subject.fx=null,e.subject.fy=null}return s.drag().on("start",e).on("drag",i).on("end",n)}function o(t,e){return Math.sqrt((t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y))}function a(t,e,i){var n;return e.x>t.x?e.y>t.y?n=Math.asin((e.y-t.y)/i):(n=Math.asin((t.y-e.y)/i),n=-n):e.y>t.y?(n=Math.asin((e.y-t.y)/i),n=Math.PI-n):(n=Math.asin((t.y-e.y)/i),n-=Math.PI),n*=180/Math.PI,"translate("+t.x+","+t.y+")rotate("+n+")"}e["a"]={config:{width:300,height:300,nodes:[],links:[],isScale:!0,scaleExtent:[.1,4],chargeStrength:400,collide:70,r:30,linkColor:"#bad4ed",markerColor:"steelblue",rectFill:"blue",textFill:"#c2c2c2",strokeWidth:2,svgClick:null},nodeData:null,id:null,simulation:null,SVG:null,defs:null,marker:null,relMap_g:null,links:null,edges:null,circles:null,texts:null,markerWidth:10,init:function(t,e){var i=this;this.id=t,this.nodeData=null,this.config=Object(n["a"])(Object(n["a"])({},this.config),e);var r=this;return this.simulation=s.forceSimulation(this.config.nodes).force("link",s.forceLink(this.config.links).id((function(t){return t.id}))).force("center",s.forceCenter(this.config.width/2+150,this.config.height/2)).force("charge",s.forceManyBody().strength(this.config.chargeStrength).distanceMax(100)).force("collide",s.forceCollide(this.config.collide).strength(.2).iterations(5)).alphaDecay(.2),this.SVG=s.select("#"+t).append("svg").attr("width",this.config.width).attr("height",this.config.height).call(s.zoom().scaleExtent(this.config.scaleExtent).on("zoom",(function(t){i.config.isScale&&r.relMap_g.attr("transform",t.transform)}))).on("click",(function(t){"circle"!=t.target.tagName&&"CIRCLE"!=t.target.tagName&&(i.nodeData=null),i.config.svgClick&&i.config.svgClick(i.nodeData)})).on("dblclick.zoom",null),this.defs=this.SVG.append("defs"),this.marker=this.defs.append("marker").attr("id","marker").attr("markerWidth",this.markerWidth).attr("markerHeight",this.markerWidth).attr("refX",this.config.r+6+this.config.strokeWidth).attr("refY",4).attr("orient","auto").attr("markerUnits","userSpaceOnUse").append("path").attr("d","M 0 0 8 4 0 8Z").attr("fill",this.config.markerColor),this.setPatterns(),this.relMap_g=this.SVG.append("g").attr("class","relMap_g").attr("width",this.config.width).attr("height",this.config.height),this.gedges=this.relMap_g.append("g").attr("class","edges"),this.setEdges(),this.setCircles(),this.simulationTick(),this},setPatterns:function(){var t=this;this.defs.selectAll("pattern.patternclass").remove();var e=this.defs.selectAll("pattern.patternclass").data(this.config.nodes),i=e.enter().append("pattern").attr("class","patternclass").attr("id",(function(e){return"avatar"+t.id+e.id})).attr("width","1").attr("height","1");i.append("rect").attr("x","0").attr("y",0).attr("width",2*this.config.r).attr("height",2*this.config.r).attr("fill",(function(e){return e.style.fill||t.config.rectFill})),i.append("text").attr("x",this.config.r).attr("y",1.14*this.config.r).attr("text-anchor","middle").attr("fill","#fff").style("font-size",this.config.r/3).text((function(t){return t.name}))},setEdges:function(){var t=this,e=this;this.gedges.selectAll("g.edge").remove();var i=this.gedges.selectAll("g.edge").data(this.config.links),n=i.enter().append("g").attr("class","edge");n.append("path").attr("class","links").attr("id",(function(t){return"path"+e.id+t.id})).attr("d",(function(t){return"M"+(e.config.r+e.markerWidth)+",0 L"+o(t.source,t.target)+",0"})).style("marker-end","url(#marker)").attr("stroke",(function(t){var i=t.color?t.color:e.config.linkColor;return i})),n.append("text").attr("class","texts").attr("y",-2).attr("fill",this.config.textFill).attr("text-anchor","end").style("cursor","pointer").style("font-size",8).text((function(t){return t.type})).on("mouseover",(function(){s.select(this).attr("fill","#ffffff").style("font-size",10)})).on("mouseout",(function(){s.select(this).attr("fill",e.config.textFill).style("font-size",8)})).on("click",(function(){t.config.textClick&&t.config.textClick()})),this.edges=this.gedges.selectAll("g.edge"),this.links=this.gedges.selectAll("path.links"),this.texts=this.gedges.selectAll("text.texts")},setCircles:function(){var t=this;this.relMap_g.selectAll("circle.circleclass").remove();var e=this.relMap_g.selectAll("circle.circleclass").data(this.config.nodes);e.enter().append("circle").attr("class",(function(t){return"circleclass i"+t.typeKey})).style("cursor","pointer").attr("fill",(function(e){return"url(#avatar"+t.id+e.id+")"})).attr("stroke",(function(t){return t.style.stroke||"#ccf1fc"})).attr("stroke-width",this.config.strokeWidth).attr("r",this.config.r).on("mouseover",(function(){s.select(this).attr("stroke-width","4"),s.select(this).attr("stroke","#a3e5f9")})).on("mouseout",(function(){s.select(this).attr("stroke-width",t.config.strokeWidth),s.select(this).attr("stroke",(function(t){return t.style.stroke||"#ccf1fc"}))})).on("click",(function(e,i){t.nodeData=i})).on("dblclick",(function(e,i){t.highlightObject(i)})).call(r(this.simulation)),this.circles=this.relMap_g.selectAll("circle.circleclass")},simulationTick:function(){var t=this,e=this.config.r+this.markerWidth;this.simulation.on("tick",(function(){t.edges.attr("transform",(function(t){return a(t.source,t.target,o(t.source,t.target))})),t.links.attr("d",(function(e){return"M"+(t.config.r+t.markerWidth)+",0 L"+o(e.source,e.target)+",0"})),t.texts.attr("x",(function(t){return t.target.x>t.source.x?o(t.source,t.target)-e:e})).attr("text-anchor",(function(t){return t.source.x>t.target.x?"start":"end"})).attr("transform",(function(t){if(t.target.x<t.source.x){var e=o(t.source,t.target)/2;return"rotate(180 "+e+" 0)"}return"rotate(0)"})),t.circles.attr("cx",(function(t){return t.x})).attr("cy",(function(t){return t.y}))}))},update:function(t){var e=this;this.config=Object(n["a"])(Object(n["a"])({},this.config),t),this.simulation.nodes(this.config.nodes).force("link",s.forceLink(this.config.links).id((function(t){return t.id}))).alphaTarget(.2).restart(),setTimeout((function(){e.simulation.alphaTarget(0)}),200),this.setPatterns(),this.setEdges(),this.setCircles()},search:function(t,e){if(!t)return[];var i=[];return this.config.nodes.forEach((function(n){for(var s=0;s<e.length;s++){var r=e[s];if(n[r]&&n[r].indexOf(t)>-1)return void i.push(n)}})),i},highlighted:null,dependsNode:[],dependsLinkAndText:[],highlightObject:function(t){var e=this;if(t){var i=t.index;e.dependsNode=e.dependsNode.concat([i]),e.dependsLinkAndText=e.dependsLinkAndText.concat([i]),e.config.links.forEach((function(t){i==t["source"]["index"]?e.dependsNode=e.dependsNode.concat([t.target.index]):i==t["target"]["index"]&&(e.dependsNode=e.dependsNode.concat([t.source.index]))})),e.SVG.selectAll("circle").filter((function(t){return-1==e.dependsNode.indexOf(t.index)})).transition().style("opacity",.1),e.SVG.selectAll(".edge").filter((function(t){return-1==e.dependsLinkAndText.indexOf(t.source.index)&&-1==e.dependsLinkAndText.indexOf(t.target.index)})).transition().style("opacity",.1)}else e.SVG.selectAll("circle").transition().style("opacity",1),e.SVG.selectAll(".edge").transition().style("opacity",1),e.highlighted=null,e.dependsNode=[],e.dependsLinkAndText=[]}}},dd8b:function(t,e,i){"use strict";i("7fe2")}});