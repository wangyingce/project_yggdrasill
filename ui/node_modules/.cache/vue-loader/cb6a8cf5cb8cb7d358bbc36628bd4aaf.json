{"remainingRequest":"/Users/eruda/Documents/GitHub/project_yggdrasill/ui/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/eruda/Documents/GitHub/project_yggdrasill/ui/src/components/IndexPage.vue?vue&type=style&index=0&id=37c61601&scoped=true&lang=css&","dependencies":[{"path":"/Users/eruda/Documents/GitHub/project_yggdrasill/ui/src/components/IndexPage.vue","mtime":1620695562000},{"path":"/Users/eruda/Documents/GitHub/project_yggdrasill/ui/node_modules/css-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/eruda/Documents/GitHub/project_yggdrasill/ui/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":499162500000},{"path":"/Users/eruda/Documents/GitHub/project_yggdrasill/ui/node_modules/postcss-loader/src/index.js","mtime":499162500000},{"path":"/Users/eruda/Documents/GitHub/project_yggdrasill/ui/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/eruda/Documents/GitHub/project_yggdrasill/ui/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouY29udGVudCB7CiAgaGVpZ2h0OiAxMDAlOwogIHdpZHRoOiAxMDAlOwogIG1hcmdpbjogMDsKICBwYWRkaW5nOiAwOwogIG92ZXJmbG93LXk6IGhpZGRlbjsKICBiYWNrZ3JvdW5kLWNvbG9yOiAjMmUyZDJkOwogIGNvbG9yOiAjZmZmOwp9Ci5wZHRvcDE1IHsKICBwYWRkaW5nLXRvcDogMTVweDsKfQoudGl0bGUxIHsKICBmb250LXNpemU6IDE4cHg7CiAgY29sb3I6ICNiN2IzYjM7CiAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICM3Nzc7CiAgcGFkZGluZy1ib3R0b206IDhweDsKfQojc3ZnIHsKICBoZWlnaHQ6IDEwMCU7CiAgd2lkdGg6IDEwMCU7Cn0KLmxlZnQtY29udGVudCB7CiAgcG9zaXRpb246IGZpeGVkOwogIHRvcDogMDsKICBsZWZ0OiAwOwogIGJvdHRvbTogMDsKICB3aWR0aDogMzAwcHg7CiAgcGFkZGluZzogMTBweDsKICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZCAjNTU1OwogIGJhY2tncm91bmQtY29sb3I6ICNmZmZmZmYwZjsKfQouaGVhZGVyIHsKICBmb250LXNpemU6IDMwcHg7CiAgZm9udC13ZWlnaHQ6IGJvbGRlcjsKfQouZGF0YS1saXN0LXJvdyB7CiAgcGFkZGluZzogNHB4IDhweDsKICBjdXJzb3I6IHBvaW50ZXI7CiAgd29yZC1icmVhazogYnJlYWstYWxsOwp9Ci5kYXRhLWxpc3Qtcm93LmFjdGl2ZSB7CiAgYmFja2dyb3VuZC1jb2xvcjogIzVkNWQ1ZDsKICBib3JkZXItcmFkaXVzOiA0cHg7Cn0KLnRhZ3MgewogIHBvc2l0aW9uOiBmaXhlZDsKICB0b3A6IDA7CiAgbGVmdDogMzIwcHg7CiAgcmlnaHQ6IDA7CiAgcGFkZGluZzogMTBweDsKICBtaW4taGVpZ2h0OiAyMHB4OwogIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjNTU1OwogIGJhY2tncm91bmQtY29sb3I6ICNmZmZmZmYwZjsKICBkaXNwbGF5OiBmbGV4OwogIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjsKfQoK"},{"version":3,"sources":["IndexPage.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"IndexPage.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div class=\"content\">\n    <div class=\"tags\">\n      <div style=\"display: flex;align-items: center;\">\n        <el-tag v-for=\"(it, i) in tags\" :key=\"i\"\n          type=\"info\" size=\"mini\" effect=\"dark\" style=\"margin-left:10px;cursor:pointer\"\n          @click=\"tagClick(it)\"\n          :color=\"it[0].style.fill\" >{{i}}({{it.length}})</el-tag>\n      </div>\n    </div>\n    <div class=\"left-content\">\n      <div style=\"height: 100%;\">\n        <el-scrollbar style=\"height:100%\" wrap-style=\"overflow-x: hidden;\" view-style=\"overflow-x: hidden;\">\n          <div class=\"header\">知识图谱</div>\n          <div class=\"pdtop15\">\n            <el-input size=\"mini\" placeholder=\"搜索\" clearable v-model=\"input1\" @keyup.native.enter=\"search\">\n              <el-button slot=\"append\" type=\"primary\" size=\"mini\" @click=\"search\">搜索</el-button>\n            </el-input>\n          </div>\n          <div class=\"pdtop15\" v-show=\"dataList && dataList.length > 0\">\n            <div class=\"title1\">查询结果：</div>\n            <div style=\"height: 180px;\">\n                <el-scrollbar style=\"height:100%\" wrap-style=\"overflow-x: hidden;\" view-style=\"overflow-x: hidden;\">\n                  <div v-for=\"(it, i) in dataList\" :key=\"i\"\n                    :class=\"'data-list-row' + (activeI == i ? ' active' : '')\"\n                    @click=\"selectRow(i)\"\n                    >name: {{it.name}}</div>\n                </el-scrollbar>\n            </div>\n          </div>\n          <div class=\"pdtop15\" v-show=\"tooltip\">\n            <div class=\"title1\">properties：</div>\n            <div v-for=\"(it, i) in (tooltip || {})\" :key=\"i\" style=\"padding-left: 8px;\">{{i}}：{{it}}</div>\n            <div class=\"pdtop15\">\n              <el-button size=\"mini\" @click=\"modify\">修改节点</el-button>\n            </div>\n          </div>\n        </el-scrollbar>\n      </div>\n    </div>\n    <div ref=\"svgDiv\" id=\"svg\" :class=\"(svgFocus ? 'cfocus' : '')\"></div>\n    \n    <NodeDialog\n      v-if=\"dialogVisible\"\n      :title=\"title\"\n      :formData=\"formData\"\n      :propertiesList=\"propertiesList\"\n      :disabled=\"false\"\n      @close=\"nodeDialogClose\" @ok=\"nodeDialogOk\" />\n  </div>\n</template>\n\n<script>\nimport DrawForce from \"@/plugins/drawForce\"\nimport axios from 'axios'\nimport NodeDialog from './NodeDialog'\n\nlet timer\nexport default {\n  name: \"IndexPage\",\n  components: {NodeDialog},\n  inject: ['reload'],\n  data() {\n    return {\n      nodes: [],\n      links: [],\n      tags: {},\n      propertiesList: [\n        {key: 'name', label:['name']},\n        {key: 'identNum', label:['身份证']},\n        {key: 'policyNum', label:['保单', '保单号']},\n        {key: 'stard', label:['起期', '保险起期']},\n        {key: 'endd', label:['止期', '保险止期']},\n        {key: 'accd', label:['出险', '出险时间']},\n        {key: 'payNum', label:['银行卡']},\n        {key: 'reportD', label:['报案', '报案时间']},\n        {key: 'reportNum', label:['报案电话']}\n      ],\n      input1: '',\n      dataList: [],\n      nodeData: null,\n      tooltip: null,\n      activeI: '',\n      svgFocus: false,\n      dialogVisible: false,\n      title: '',\n      d: null\n    }\n  },\n  methods: {\n    nodeDialogClose() {\n      this.dialogVisible = false\n    },\n    nodeDialogOk() {\n      this.nodeDialogClose()\n    },\n    modify() {\n      this.formData = this.nodeData || {}\n      this.title = \"修改节点\"\n      this.dialogVisible = true\n    },\n    // 点击标签时的处理\n    tagClick(it) {\n      this.svgFocus = true\n      this.selectRow('null')\n      this.removeTagHighlight()\n      let arr2 = document.getElementsByClassName(\"i\"+it[0].id)\n      for (let i = arr2.length - 1; i > -1; i--) {\n        arr2[i].classList.add('tagHighlight')\n      }\n    },\n    // 清空高亮的块\n    removeTagHighlight() {\n      let arr = document.getElementsByClassName('tagHighlight')\n      for (let i = arr.length - 1; i > -1; i--) {\n        arr[i].classList.remove('tagHighlight')\n      }\n    },\n    // 按name搜索\n    search() {\n      if(!this.d)return\n      if(!this.input1) {\n        this.dataList = []\n        this.selectRow('null')\n        return\n      }\n      this.dataList = this.d.search(this.input1, ['name']) // 查询name相同的数据\n      this.selectRow(this.dataList.length ? 0 : 'null')\n    },\n    // 选中一行\n    selectRow(i) {\n      let d = this.d\n      let dataList = this.dataList\n      this.activeI = null\n      d.highlightObject()\n      if (dataList && dataList[i]) {\n        d.highlightObject(dataList[i])\n        d.nodeData = dataList[i]\n        this.drawTooltip(d.nodeData, 'selectRow')\n        this.activeI = i\n      }\n    },\n    // 更新Tooltip信息\n    drawTooltip(data) {\n      this.nodeData = data\n      if (data && data.properties && Object.keys(data.properties).length > 0) {\n        this.tooltip = data.properties\n      } else {\n        this.tooltip = null\n      }\n    },\n    // 点击svg时的处理\n    svgClick(data) {\n      this.d.highlightObject()\n      this.drawTooltip(data)\n      this.svgFocus = false\n      this.selectRow(\"null\")\n    },\n    // 初始化D3\n    startD3(nodes, links ) { // tags\n      this.d = DrawForce.init('svg', {\n        width: window.document.body.offsetWidth,\n        height: window.document.body.offsetHeight,\n        nodes, links,\n        svgClick: this.svgClick\n      })\n    },\n    reset() {\n      this.dataList = []\n      this.tooltip = null\n      this.$refs.svgDiv.innerHTML = ''\n    },\n    windowResize() {\n      if(timer)clearTimeout(timer);\n      timer = setTimeout(() => {\n        this.reset()\n        timer=undefined\n        this.startD3(this.nodes, this.links, this.tags)\n      }, 300)\n    },\n    initData() {\n       let vm = this\n      axios.get('/visionAllData' + location.search)\n      .then(function (response) {\n        if(response.status != 200 || response.data.error) {\n          vm.$message.error(response.data.error || response.statusText)\n          return\n        }\n        let json = response.data\n        vm.setData(json)\n      })\n      .catch(function (error) {\n        console.log(error)\n      });\n    },\n    setData(data){\n      let vm = this\n      let nodes = data.nodes || []\n      let links = data.edges || []\n      let tags = {}\n      nodes.forEach((element) => {\n        if (element.type) {\n          tags[element.type] = tags[element.type] || []\n          tags[element.type].push(element)\n          element.typeKey = tags[element.type][0].id // 取第一个id当相同的key\n        }\n      });\n      vm.nodes = nodes\n      vm.links = links\n      vm.tags = tags\n      vm.startD3(nodes, links, tags)\n    },\n  },\n  mounted() {\n    this.initData()\n    window.addEventListener('resize', this.windowResize)\n  },\n  destroyed() {\n    window.removeEventListener('resize', this.windowResize)\n  }\n};\n</script>\n\n<style scoped>\n.content {\n  height: 100%;\n  width: 100%;\n  margin: 0;\n  padding: 0;\n  overflow-y: hidden;\n  background-color: #2e2d2d;\n  color: #fff;\n}\n.pdtop15 {\n  padding-top: 15px;\n}\n.title1 {\n  font-size: 18px;\n  color: #b7b3b3;\n  border-top: 1px solid #777;\n  padding-bottom: 8px;\n}\n#svg {\n  height: 100%;\n  width: 100%;\n}\n.left-content {\n  position: fixed;\n  top: 0;\n  left: 0;\n  bottom: 0;\n  width: 300px;\n  padding: 10px;\n  border-right: 1px solid #555;\n  background-color: #ffffff0f;\n}\n.header {\n  font-size: 30px;\n  font-weight: bolder;\n}\n.data-list-row {\n  padding: 4px 8px;\n  cursor: pointer;\n  word-break: break-all;\n}\n.data-list-row.active {\n  background-color: #5d5d5d;\n  border-radius: 4px;\n}\n.tags {\n  position: fixed;\n  top: 0;\n  left: 320px;\n  right: 0;\n  padding: 10px;\n  min-height: 20px;\n  border-bottom: 1px solid #555;\n  background-color: #ffffff0f;\n  display: flex;\n  justify-content: space-between;\n}\n\n</style>\n"]}]}